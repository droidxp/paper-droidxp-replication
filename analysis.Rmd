---
title: "Exploratory Analysis"
author: anonymous
date: "5/27/2022"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(sqldf)
setwd(".")
```

### Load the dataset

17 
```{r load}

dataset <- read.csv("summaryAll.csv", head=T, sep=",")
colnames(dataset)
nrow(dataset)


dataset["CallDiffDetection"] = dataset$methods_in_diff > 0 

dataset["TotalSim"] = dataset$method_identical + dataset$method_similar + dataset$method_deleted + dataset$method_new

dataset["C1"] = dataset$method_identical / (dataset$TotalSim - dataset$method_new)
dataset["C2"] = dataset$method_identical / (dataset$TotalSim - dataset$method_deleted)
                                            


dataset["SimilarityIndex"] = ifelse(dataset$C1 > dataset$C2, dataset$C1, dataset$C2)


##  [1] "app"                    "method_identical"       "method_similar"        
##  [4] "method_new"             "method_deleted"         "simiscore"             
##  [7] "methods_in_diff"        "repetitionpermitition"  "repetitionaction"      
## [10] "executionwithtracediff" "hash"                   "scanDate"              
## [13] "detection"              "total"                  "link"                  
## [16] "euphonyType"

sqldf("select app, C1, C2, SimilarityIndex, simiscore from dataset")
```

### Summarizing our dataset 

   * here we see that 346 out 1203 malware instances (28.76%) have been detected by the the CallDiff approach
   
```{r summary}
summary(dataset$CallDiffDetection)
```

### Compute the correlation between similarity and methods in diff

   * note, methods_in_diff reports the number of methods in the set CallDiff. Not sure if "correlation" is relevant 
   
```{r correlation}
cor(dataset$methods_in_diff, dataset$simiscore, method="spearman") # non-parametric
```


### Logistic regression 

   * Here we want to understand if the simmilarity coefficient is statistically relevant or not, for predicting the CallDiff performance. The result suggests the contrary. 
   
```{r logisticRegression}
model = glm(CallDiffDetection~simiscore, family = binomial(link = "logit"), data = dataset) 



summary(model)

model = glm(CallDiffDetection~SimilarityIndex, family = binomial(link = "logit"), data = dataset) 

summary(model)
```

### Let's review our results, but now considering just a small subset of the malwares. 

   * First loading the original dataset. 

```{r load-original}
sqldf("select count(*) from dataset where executionwithtracediff > 0 and CallDiffDetection == FALSE")


sqldf("select count(*) from dataset where (repetitionpermitition == 'True' or repetitionaction == 'True') and CallDiffDetection == FALSE")


sqldf("select count(*) from dataset where (repetitionpermitition == 'True' or repetitionaction == 'True' or executionwithtracediff > 0) and CallDiffDetection == FALSE")


original <- read.csv("originalMalwareSample.csv", head=T, sep=',')

smallDataset <- sqldf("select d.* from dataset d, original o where d.app = o.app")

summary(smallDataset$CallDiffDetection)

# executionWIthTraceDiff repetitionAction

sqldf("select count(*) from smallDataset where executionwithtracediff > 0 and CallDiffDetection == FALSE")


sqldf("select count(*) from smallDataset where (repetitionpermitition == 'True' or repetitionaction == 'True') and CallDiffDetection == FALSE")


sqldf("select count(*) from smallDataset where (repetitionpermitition == 'True' or repetitionaction == 'True' or executionwithtracediff > 0) and CallDiffDetection == FALSE")

```
   
   
   * The results above confirm that, for the original dataset (101 malwares), the 
   performance of the CallDiff is superior (> 65%). Nonetheless, it seems to me that the 
   similarity coefficient can not explain such a difference. 
   
```{r}
sqldf("select euphonyType, CallDiffDetection, count(*) from dataset group by euphonyType, CallDiffDetection")
sqldf("select euphonyType, CallDiffDetection, count(*) from smallDataset group by euphonyType, CallDiffDetection")

sqldf("select avg(method_identical), avg(method_similar), avg(method_new), avg(method_deleted), avg(methods_in_diff), avg(simiscore) 
       from dataset")


sqldf("select  avg(method_identical), avg(method_similar), avg(method_new), avg(method_deleted), avg(methods_in_diff), avg(simiscore) 
       from smallDataset")

```
   
