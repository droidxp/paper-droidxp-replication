---
title: "Dataset Merge"
author: "anonymous"
date: '2022-10-14'
output: html_document
description: This script create our final dataset file for analysis - final-ds.csv
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(fig.width=5, fig.height=5, fig.path='./figures/', dev=c('png', 'pdf'))

setwd(".")

library(sqldf)
library(xtable)
```

## Merge Script


The purpose of this R script is to merge several datasets into a single one. 
The following datasets are merged:

   * *appsHash* contains the hash of all apps, including information to indicate 
   if a given asset is an original or a repackaged version of an app. 
   
   * *avclass* contains the results of using the tool av2class to identify 
   the family of the malware in our dataset. 
   
   * *originalMalwareSample* contains the hash of the apps used in the 
   Bao et al. study. 
   
   * *summaryTypeFamily.csv* contains the outputs of the mining android sandbox 
   approach. 
   
We merge the above datasets and export the results to a file named *final-ds.csv*.   

```{r vt}

#Load the Datasets
apps <- read.csv("appsHash.csv", head=T, sep=',')

repackaged <- sqldf("select * from apps where app like 'malicious%'")

nrow(repackaged)

avclass <- read.csv("avclass.csv", head=T, sep=',')

nrow(avclass)

avclass <- sqldf("select * 
                  from avclass 
                  where family != 'noIdentify' and family not like 'SINGLETON%'")

nrow(avclass)
write.csv(avclass, "av.csv", quote = F, row.names = F)

#hashes <- read.csv("sha256-md5-app.csv",head=T, sep=',')


#nrow(hashes)


s1 <- sqldf("select r.app, r.hash, a.family as family, 'True' as Malware
				from repackaged r, avclass a where r.hash = a.sha256")
						 

s2 <- sqldf("select r.app, r.hash, 'None' as family, 'False' as Malware
                   from repackaged r
                   where r.hash not in (select a.sha256 from avclass a)")

nrow(s1)

nrow(s2)

ds <- rbind(s1, s2)



masResults <- read.csv("summarySimiDroid.csv", head=T)

final_ds <- sqldf("select substring(ds.app,11) as app, ds.hash as hash, ds.family as family, ds.Malware as malware from ds")

colnames(final_ds)
head(final_ds)


 write.csv(final_ds, "final-ds.csv",  quote = F, row.names = F)
```




